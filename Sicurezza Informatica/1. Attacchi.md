
- [Attaccanti](#attaccanti)
- [Attacchi](#attacchi)
  - [Safety vs Security](#safety-vs-security)
  - [Attaccanti vs. Difensori](#attaccanti-vs-difensori)
  - [Mercati](#mercati)
    - [Cyber Forum](#cyber-forum)
    - [Dark Web](#dark-web)
    - [Gruppi Underground](#gruppi-underground)
  - [Come si Attacca un'Azienda](#come-si-attacca-unazienda)
    - [Prima fase](#prima-fase)
    - [Seconda fase](#seconda-fase)
      - [CEO Freud](#ceo-freud)
      - [Trojan](#trojan)
      - [Movimento Laterale](#movimento-laterale)
  - [Attaccanti Interni](#attaccanti-interni)
  - [Motivazioni](#motivazioni)
    - [Azioni Deliberate](#azioni-deliberate)
  - [Cyber Space](#cyber-space)
- [Aziende](#aziende)
  - [Sistema di Credito Sociale](#sistema-di-credito-sociale)
- [Vulnerabilità delle Applicazioni](#vulnerabilità-delle-applicazioni)
  - [Il Codice](#il-codice)
  - [Mediazione Incompleta](#mediazione-incompleta)
    - [Contromisure](#contromisure)
  - [Time of Check to Time of Use (TOC/TOU)](#time-of-check-to-time-of-use-toctou)
    - [Esempio TOC/TOU](#esempio-toctou)
  - [Contromisure](#contromisure-1)
  - [Code Injection](#code-injection)
    - [Buffer Overflow (BOF)](#buffer-overflow-bof)
      - [Motivazioni](#motivazioni-1)
      - [Esempio](#esempio)
      - [Possibile Soluzione](#possibile-soluzione)
    - [Alterazione del Flusso di Esecuzione](#alterazione-del-flusso-di-esecuzione)
    - [Shellcode](#shellcode)
  - [Exploit](#exploit)
  - [Tecniche Ausiliarie](#tecniche-ausiliarie)
    - [NOP sled](#nop-sled)
      - [Esempio: No Operation](#esempio-no-operation)
    - [Indirizzo di Ritorno Ripetuto dopo lo Shellcode](#indirizzo-di-ritorno-ripetuto-dopo-lo-shellcode)
- [Vulnerabilità Web App](#vulnerabilità-web-app)
  - [SQL Injection](#sql-injection)
    - [Blind SQL Injection](#blind-sql-injection)
    - [Injection basate su UNION](#injection-basate-su-union)
    - [Numero di Colonne con ORDER BY](#numero-di-colonne-con-order-by)
    - [Accesso ai File](#accesso-ai-file)
  - [Cross Site Scripting](#cross-site-scripting)
    - [Provvedimenti](#provvedimenti)
- [Causa delle Vulnerabilità](#causa-delle-vulnerabilità)
  - [Buffer Overflow - Good Practices](#buffer-overflow---good-practices)
    - [Livello di Programmazione](#livello-di-programmazione)
    - [Livello di Kernel](#livello-di-kernel)
    - [Livello di Compilatori](#livello-di-compilatori)
  - [SQL Injection - Good Practices](#sql-injection---good-practices)
    - [Prepared Statement](#prepared-statement)
  - [XSS - Good Practices](#xss---good-practices)
- [Malware](#malware)
  - [Tipologie](#tipologie)
    - [Virus](#virus)
    - [Trojan](#trojan-1)
    - [Logic Bomb](#logic-bomb)
    - [Virus Polimorfico](#virus-polimorfico)
    - [Virus Metamorfico](#virus-metamorfico)
    - [Confronto Virus e Worm](#confronto-virus-e-worm)
  - [Ciclo di Vita delle Vulnerabilità](#ciclo-di-vita-delle-vulnerabilità)
    - [Attacchi Zero-day](#attacchi-zero-day)
  - [Scopi dello Spyware](#scopi-dello-spyware)
  - [Ransomware](#ransomware)
  - [Cyber Weapon](#cyber-weapon)
    - [Esempi di CW](#esempi-di-cw)
      - [Stuxnet](#stuxnet)
      - [Red October](#red-october)
      - [NotPetya](#notpetya)
  - [Advanced Persistent Treat (APT)](#advanced-persistent-treat-apt)
  - [Tipologie di Attacchi](#tipologie-di-attacchi)
  - [Lateral Movement](#lateral-movement)
  - [Man in the Middle (MitM)](#man-in-the-middle-mitm)

# Attaccanti
Rappresentano le principali minacce da cui ci si deve difendere. Gli attaccanti rappresentano una *piccola minoranza* dell'utenza di internet. Le tecnologie cyber consentono di automatizzare gli attacchi e portarli al di là di confini geografici. Un terminale informatico può essere in grado di causare danni a un gran numero di computer, rubando una grande quantità di dati in tempo ridotto. Non sempre c'è la necessità di presentarsi sul posto per un attacco, quindi spesso si agisce nell'anonimato. Se a questo si aggiunge il fatto che non è necessario essere dei "maghi del computer" diventa alla portata di molti.

Se si considera un computer collegato a internet non protetto, questo subisce degli attacchi molto frequentemente, generalmente anche in pochi secondi. ì chiaro che non ci sono persone costantemente persone che cercano di attaccarlo, sono processi automatizzati. Non sempre gli attacchi hanno successo: sono per la maggior parte delle volte, dei tentativi. I punti deboli sono generalmente:
- Software non aggiornati: possono presentare vulnerabilità note anche da tempo. Basta fare una ricerca mirata con dei plugin sull'applicazione di mio interesse per attaccarla.
- Malware: installati medianti mail (phishing) oppure siti web che promettono di far scaricare programmi craccati, e insieme ad essi scaricano un malware.
- Password banali: l'essere umano è un pessimo generatore di password ('123456778' è sempre una delle password più diffuse e banali, insieme alla propria data di nascita e quella delle persone a noi vicine).
- Phishing per installare malware e rubare password
- Man-in-the-browser per rubarmi le credenziali nel tentativo di accesso a un sito web

# Attacchi
Nel mercato digitale, abbiamo alcuni vincitori su cui si eseguono attacchi. tra queste grandi aziende troviamo Google, Facebook, Instagram. Sono quasi tutte aziende legate ai servizi (piuttosto che alla manufattura). Questi servizi sono direttamente dalle persone: grandi concentratori di dati derivanti da persone diverse che li utilizzano. In molti utilizzano Gmail o Google come motore di ricerca, Amazon per fare acquisti: si tratta di servizi veloci, sempre disponibili e di immediata interazione. Se gli utenti fanno affidamento sull'azienda per il servizio, l'azienda utilizza questi dati per trarne ulteriore guadagno. Vulnerabilità a livello di perosne, di dati, e di software e servizi (dati che possono essere modificati), ma anche hardware. Non sempre gli attaccanti hanno limiti: una volta raggiunto l'obiettivo, l'attaccante a un vantaggio facendo un danno a chi lo subisce: l'azienda o la persona. I diversi tipi di danni sono:
- Furti di denare, truffe, estorsioni
- Fermo operatività
- Furto di informazioni aziendali: clienti, fornitori, scontistica
- Danno reputazionale: se un provider di dati viene attaccato deve notificare i loro utenti che i loro danni e le loro password sono diventati di dominio pubblico. Oltre alle cause legali, perdono di affidabilità e riscontrano un danno economico. Nel caso di un azienda che ha dati finanziari o sanitari un danno reputazionale può avere un grande impatto.
- Perdita di mercato per mancata compliance, senza la quale non otteniamo più lavori.

## Safety vs Security
Quale di questi danni è il più grave? Dipende. Tutti questi danni riguardano sistemi IT tradizionali, sistemi che trattano dati. Ora ci sono nuovi danni legati all'Industria 4.0, Smart City, Logistica con trasporti gestiti in maniera automatica, Settore Medico. La Safety si distingue dalla Security: la prima riguarda la sicurezza fisica delle persone, mentre la seconda quella dei dati. Un'altra dimensione del danno è quindi relativa alla Safety, con danni a dispositivi per la salute: pacemaker, sistemi di guida autonoma, sistemi di gestione code ad un'ospedale (un paziente che ha un'urgenza e viene lasciato indietro). 

## Attaccanti vs. Difensori
Spesso pensiamo agli attacchi informatici come *eventi episodici*. Non sono tanto considerabili tali (come un meteorite, con probabilità bassa). Non è mai questione di *se arriva e come arriva*, ma è questione di *quando arriva*. Gli attaccanti sanno bene che il momento migliore per attccare un'azienda può essere il venerdì pomeriggio, quando la maggior parte del personale è assente e si ha a disposizione anche il weekend per sfruttare appieno le vulnerabilità. Un'azienda normalmente paga i propri dipendenti per lavorare in un orario prestabilito. I difensori sono *sfavoriti rispetto agli attaccanti*. 

## Mercati
### Cyber Forum
Forum di alto livello, solitamente sono pubblici. Facile entrare se si è disposti a pagare. Per l'acquisto di un servizio è necessaria la registrazione. 

### Dark Web
Si tratta di una serie di risorse raggiungibili solo opportuni strumenti software chiamati "reti anonimizzatrici": il più diffuso tra questi è Tor. Una rete di questo tipo mi consente di pubblicare un servizio senza che nessuno sappia chi sono. Per questo motivo, viene spesso utilizzawto per servizi e contenuti illegali. Qui si utilizzano prevalentemente metodi di pagamento non tracciabili come criptvalute e bitcoin. Qui è presente un sistema di ranking anche per i criminali (quelli meglio recensiti solitamente hanno più stelle). Tra le cose più vendute troviamo:
- Carte di Credito
- Dati (Finanziari, Personali, relativi alla salute)
- Droga
- Farmaci
- Armi
- Malware o Servizi per Attacchi Cyber
- Omicidi su Commissione
- Materiale Pedo Pornografico
- Credenziali: è possibile in questo modo impersonificare qualcuno.

### Gruppi Underground
Si tratta di gruppi chiusi su invito. Popolati da criminali che si conoscono tra loro: bisogna avere una certa reputazione per entrare, siccome è necessario un invito.

## Come si Attacca un'Azienda
Diversi tipi di attaccanti, con diverse modalià di spesa e diversi obiettivi. Esistono diversi approcci per questo fine:
1. Lanciare diverse esce e aspettare che qualcuno abbocchi
2. Verificare in modo automatico quale azienda è vulnerabile e attaccarla
3. Attacco mirato: puntare e attaccare un'azienda.

Si hanno dunque *attacchi generalizzati* e *attacchi mirati*. Per aziende piccole, generalmente non c'è problema. Il problema potrebbe verificarsi mano a mano che il proprio fatturato aumenta. le tecniche di phishing rappresentano la storia degli attacchi informatici. Generalmente un attacco mira a sfruttare vulnerabilità umane. Spesso le email di un attaccante hanno caratteristiche di *urgenza*. 

### Prima fase
Si ricercano informazioni sull'azienda. Partita IVA, numero di telefono, email, fornitori, trend aziendali. Questa prima ricercap mirata alla conoscenza di quanti più particolari possibili. Chi sono i dipendenti? Utilizzano i social? Chi sono i loro amici, i loro interessi: si impara a conoscerli. E' dal dipendente, che senza volerlo installa un malware, che ha inizio l'attacco. Bisogna quindi identificare i target tecnologici e quelli umani. Come target iniziale va bene più o meno qualsiasi cosa.

### Seconda fase
Una volta conosciuti i target, si selezionano i migliori e provo a instaurarne una comunicazione: telefono, email, di persona. Un attaccante più fantasioso degli altri può scegliere di utilizzare in alternativa chiavette usb che sfruttano dei malware: sopra la chiavetta ci mette un'etichetta clickbait ("foto delle vacanze", "dati importanti"), che può essere lasciata alla mercè di tutti, ad esempio abbandonata in un parcheggio. Questa chiavetta sarà la chiave per stabilire una comunicazione. Gli antivirus oggi riconoscono facilmente i malware comuni. Partendo da un malware genetico, una volta conosciuto il sistema antivirus utilizzato da un'azienda (ad esempio fingendosi un fornitore di servizi antivirus) si utilizza un Metaexploit che generi un malware mirato all'attacco.

#### CEO Freud
Frode fatta non necessariamente al CEO ma al personale amministrativo che esegue bonifici o che esegue i bonifici e ha relazioni con clienti e fornitori.

#### Trojan
Mezzo tencolgoico più utilizzato per prender epossesso di un computer aziendale.

#### Movimento Laterale
I computer aziendali non sempre possono essere raggiunti da fuori. Spesso è complicato passare *da fuori a dentro*. Con i metodi illustrati precedentemente è possibile mandare in esecuzione qualcosa all'interno di un computer aziendale. Le comunicazioni aziendali sono solitamente vloccate da internet verso l'azienda, ma dall'azienda verso internet sono generalmente concesse. Una volta che il malware è in esecuzione sul computer della vittima, è lei che contatta le persone al di fuori dell'azienda. I pezzi di codice generalmente mirano ad ottenere informazioni sugli asseti interni dell'azienda (rete locale, spazi di indirizzamento). Il computer può essere *fisicamente concesso alla rete aziendale*, ma anche *logicamente connesso ad essa* (smart working). Il lavoro dell'attaccante all'interno della rete prende il nome di *movimento laterale*. Si sfrutta sempre il fatto che *è possibile comunicare dall'interno all'esterno*.

## Attaccanti Interni
Rappresenta una delle peggiori minacce. Può passare direttamente al movimento laterale e talvolta dispone già di un'autorizzazione. Tra questi troviamo generalmente:
- Spie industriali
- Dipendenti di aziende partner
- Ex dipendenti (ai quali magari una volta si aveva dato un'accesso o un privilegio particolare per una mansione specifica)
- Amministratori di sistema incompetenti (password appicicate al monitor, al muro, in bacheca: ovviamente non rappresentano una buona soluzione)
- Dipendenti insoddisfatti (che agiscono per vendetta)
- Dipendenti bramosi di guadagno o in difficoltà economica

## Motivazioni

### Azioni Deliberate
Nella grande maggioranza dei casi sono clienti insoddisfatti che hannoa agito per vendetta. Vogliono solo fare danno all'azienda, e facendolo mettono in diffoltà i colleghi. Non richiedono particolari competenze tecniche.

## Cyber Space
Gli stati utilizzano un cyber space per proteggersi dali attacchi, per rendere sicuri e operativi i sistemi di comunicazione in modo da garantire l'integrità, confidenzialità e disponibilità dei dati, ma anche per i progetti relativi alle armi.

# Aziende
Le aziende sono interessate ai nostri dati per venderli a loro volta offrendo in questo modo un servizio. Tra le entità interessate ai servizi ottenuti con questi dati abbiamo il governo (propaganda politica), eventi sportivi, ma anche marchi come Pepsi o Coca Cola vogliono sapere cosa piace alle persone.

## Sistema di Credito Sociale
L'esempio più palese è quello della Cina. Hanno le loro versioni di qualsiasi social. Tutto ciò è utilizzato per assegnare un sistema di credito sociale a ciascun cittadino. Il cittadino ha credito sociale? Si comporta bene? Allora questo si alza, in caso contrario si abbassa. Se questo credito sociale si abbassa non puoi più espatriare, avere accesso a treni e aerei.

# Vulnerabilità delle Applicazioni
Gli attacchi sono derivanti da impegno su ingegneria sociale e da vulnerabilità del software. Queste vulnerabilità sono destinate a rimanere ovunque siano presente software. Sono presenti nelle applicazioni, sistemi operativi, protocolli di rete, di comunicazione. I software non sono perfetti: presentano bug. La parte di compilazione è seguita dal linking, che utilizza librerie esterne non programmate da me: in questo modo potrei portarmi dietro bug di altre librerie. Un bug è inteso come un flusso di programmazione che non si comporta come previsto dal programmatore. L'utente normale non presta attenzione al bug: semplicemente riavvia e va avanti, l'attaccante informatico no. L'attaccante riconosce che facendo una sequenza predefinita di azioni è possibile deviare dal flusso di esecuzione previsto dal programmatore. E' in questo momento che l'applicazione comincia a fare quello che vuole l'attaccante: le vulnerabilità sono quindi considerabili come dei *sottoinsiemi di bug*. Le vulnerabilità sono dentro al codice. Fino a quando non viene pubblicato un update per correggere il bug questo rimane con un software vulnerabile.

## Il Codice
Il codice è spesso di *scarsa qualità*. I programmatori non sono preparati a dovere sui problemi di sicurezza informatica. Alcune tecnologie, specie quelle di basso livello come C e C++ rappresentano un pericolo più di altre per la loro fragilità: consentono al programmatore di accedere facilmente alle aree di memoria. Consente sì di fare applicazioni ottimizzate e veloci, ma bisogna utilizzare con consapevolezza. Sarebbe meglio se ci sono metodi di controllo di correttezza formale. Alcuni contesti in cui metodi di verifica formale esistono ci sono, ma non sempre sono utilizzati. Ogni codice che non considera flussi di esecuzione paralleli che agiscono sulle stesse risorse è spesso etichettato come sicuro, ma sono casi anche questi da tenere in considerazione. Fare uin software fatto bene richiede invevitabilmente più tempo e più costi.

## Mediazione Incompleta
Una delle principali vulnerabilità nell'applicazioni risiede nella *validazione dell'input*, ovvero un mancato controllo di quello che l'utente fa nel momento in cui interagisce con il sistema. L'applicazione processando gli inoput andrà a cambiare il suo stato interno: una _mediazione incompleta_ si ha quando si lascia la possibilità agli utenti esterni di manipolare lo stato interno del software. L'errore è generalmente qualcosa di imprevisto che mi fa accedere qaa dati che non mi riguardano. Anche gli applicativi tradizionali (nostri computer)  sono soggetti a mediazione incompleta. Utilizzano file temporanei per materializzare per un po' di tempo dei file di stato. Se un utente modifica direttamente quei file (l'accesso può essere aperto) e questi dati modificano i successivi accessi è sempre possibile cambiare il comportamento del software.

### Contromisure
Talvolta per difendersi dall'esposizione dei dati agli utenti esterni è necessario riprogettare interamente il software.

## Time of Check to Time of Use (TOC/TOU)
Questa classe di errori logici avviene all'interno di sistemi multiutente e multi programmati dove si hanno diversi fglussi di esecuzione che si interlacciano in modo arbitrario: si tratta di problemi di sincronizzazione. Si tratta di combinazioni particolarmente sfortunate in cui due utenti eseguono una certa sequenza di operazioni con una certa tempistica. La condizione che mi permetteva di accedere a dei file può diventare falsa tra il tempo di controllo e quello di utilizzo: l'accesso dovrebbe essere negato. Ci deve essere qualcosa che fa cambiare queste condizioni: solitamente il *flusso di esecuzione parallelo*.

### Esempio TOC/TOU
Esempio di modifica di una pagina di wikipedia. Quando io utento entro in fase di editing l'amministratore blocca la pagina. Se il tempo di controllo è solo precedente, allora c'è un problema.

Esempio di applicazione tradizionale: non tutti gli utenti hanno accesso ai file. Si suppone che un utente voglia accedere a un file in scrittura modificandone il contenuto. Mentre il file è aperto viene fatto un link affinchè questo file punti al file delle password a cui non dovrei avere un accesso in scrittura. Supponiamo che riesca a fare questa operazione tra il controllo dei diritti di accesso e il rilascio dell'autorizzazione. L'ideale sarebbe non avere distinzione tra il tempo di controllo e quello di utilizzo. Questo succede nei sistemi monoutente e monoprogrammati dove è presente un unico flusso di esecuzione. 

## Contromisure
Devono essere utilizzate transazioni atomiche. Non tutti i sistemi supportano i sistemi di locking e di semafori. Il sistema operativo apre il file in scrittura e si salva l'handler. Se l'utente ai privilegi, gli vengono concessi relatrivi al file puntato dall'handler. Questa soluzione non rappresenta tuttavia il modo normale di fare le cose, quello normale è soggetto a vulnerabilità.

## Code Injection
Tecnica per 'iniettare' codice arbitrario in un'applicazione sfruttando il mancato controllo dell'input. I casi più semplici si hanno nei linguaggi di scripting. Vengono analizzati gli input che non sono più interpretati come dati, ma come *istruzioni*. Code Injection si ha quando la vulnerabilità comporta una confusione tra dati e codice. Per questo motivo è essenziale controllare la correttezza degli input. Tra questi i più famosi sono:
- Shell injection
- SQL injection
- Cross Site Scripting (XSS), tipicamente JavaScript

### Buffer Overflow (BOF)
Particolare tecnica su cui si basano gli attacchi di Code Injection. In C è possibile corrompere lo stato di esecuzione scrivendo dopo la fine di un vettore. Questo procedimento viene chiamato *smash of stack*: anzichè riprendere la funzione da dove era stata chiamata si finisce in un indirizzo casuale. Non sempre è casuale, l'attaccante potrebbe anche finire sull'indirizzo di memoria desiderato. Il bug è dipendente da un dato. Questi tipi di attacchi risalgono agli anni '70. L'array è un buffer di dimensione fissa (ad esempio 100 byte): arriva un input più grosso (150 byte). Si dovrebbe controllare la dimensione dell'input in modo da non andare oltre. Gli ultimi byte rimangono fuori dall'array, ma cosa c'è alla fine dell'array? E' in quest'area che il programmatore (attaccante) si riserva una sua area di 100 byte in cui può fare ciò che vuole: qui può mettere altri dati, altri byte, altri buffer. Facendo un buffer overflow su un array dichiarato staticamente allora si ottiene un *stack segment buffer overflow*, se lo si vuole fare dinamicamente è possibile farlo attraverso una *malloc*.

#### Motivazioni
L'assunzione implicita fatta dal programmatore è che nessuno acceda nell'area di memoria successiva all'array. Un errore di questo tipo è facilmente rilevabile anche in fase di compilazione.

#### Esempio
Quando il programma tenta di accedere a un'area di memoria fuori dalla sua competenza normalmente il Sistema Operativo termina. A questo talvolta segue il messaggio *core dumped*, ciò significa che lo stato del processo e i registri sono stati salvati ed è quindi possibile fare debugging. A seconda delle distribuzioni il core file viene salvato in posizioni diverse. Il core file è normalmente nominato come: `core.$APPLICATION_NAME.$PID`. E' dunque possibile manipolare l'estraction pointer. Guardo fino a che punto viene letto l'input e una volta trovato devo trovare una nuova area di memoria in cui scrivere le istruzioni. Si prende ad esempio la funzione *stampa_autore()§ sel programma *secreet* che ha come indirizzo `0x804936a`. Il codice deve essere scritto sullo standard input del programma vulnerabile.

Posso sovrascrivere l'estraction pointer con un valore arbitrario e se questo è valido vado a scrivere il codice puntato dall'estraction pointer.

#### Possibile Soluzione
Modificare il main in modo da rifiutrare una stringa di dimensioni maggiori del buffer **b[]** dove è copiata. (80 caratteri)

### Alterazione del Flusso di Esecuzione
Prende anche il nome di *bytecode injection* è e consiste nell'inserire nel programma codice già compilato. Il codice per il programma diventa indistinguibile dalle operazioni che svolge normalmente.

### Shellcode
Tipo particolare di bytecode che genera una shell. L'architettura conta: il codice eseguibile da un processore ARM sarà diverso da quello di un processore Linux a 32 o 64 bit. Se all'interno dello shellcode ritrovo con dei caratteri interpretati come *fine stringa*, le funzioni che copiano questo input e mi permettono di fare buffer overflow interrompono la copia, pertanto lo shellcode non viene copiato per intero. Le funzioni che terminano la copia sono tutti quelli che terminano le stringhe `00`, `0a`, `0d`. Una shellcode pertanto non deve contenere queste sequenze di caratteri.

## Exploit 
Si tratta dello *strumento* che consente di sfruttare la vulnerabilità del programma. Si tratta di un programma che genera una stringa da eseguire. E' necessario comunque conoscere dove andrà a finire questo comando all'interno dello stack.

Si noti che con l'indirizzo `20a` non funziona mentre con `20b` tutto funziona come prevista ottenendo *segmentation fault*. Nel caso funzionante la funzione *gets()* si ferma quando trova lo `0a`, terminatore di strignhe in C. Con il payload non funzionante non è stato sovrascritto l'indirizzo di ritorno, ma il *base pointer*. Quando la funzione è tornata indietro per riprendere la sua esecuzione ha trovato dei problemi.

L'expoit sarà quindi formato dai valori inutili necessari per riempire il buffer, la shellcode, e l'indirizzo di ritorno in cui andare ad eseguire il codice. Afficnchè tutto funzioni questo indirizzo di ritorno deve andare a puntare quello della shellcode all'interno dello stack. Lo stack non è gestito dall'attaccante ma dal sistema operativo: è necessario pertanto conoscere l'indirizzo della shellcode. L'indirizzo di ritorno deve essere individuato *precisamente*. Le istruzioni che trovo sono:
1. `JMP` che mi permette di saltare avanti nel buffer (conosco l'offset perchè la funzione la creo io). La JMP putna a una *CALL*.
2. `CALL` che mi dirotta da qualche parte. Prima salva in cima allo stack l'indirizzo successivo, come ad esempio la stringa *"/bin/sh"* che identifica un'eseguibile. La CALL punta a una POP.
3. `POP` che prende ciò che si trova in testa allo stack e lo salva su qualche registro. In seguito è presente il codice vero e proprio, la sequenza di istruzioni che fa una chiamata di sistema: *execve*, *execl* (chiamata di sistema che prende come parametro il percorso dell'eseguibile).

All'interno del software in esecuzione viene initettata una chiamata di sistema che mi permette di eseguire del codice esterno.

## Tecniche Ausiliarie

### NOP sled
Tecnica ausiliaria che semplifica l'azione dell'attaccante. L'acronimo sta per *No Operation* mentre il termine *sled* significa *slitta*, consiste nell'inserire delle istruzioni nulle prima della shellcode. in questo modo, anche se non sono preciso, *l'extraction pointer* con cui è possibile sovrascrivere l'extraction pointer del programma può anche non puntare in un punto preciso. Più è lungha la *NOP sled*, più sono rilassati i vincoli.

#### Esempio: No Operation
Caso più semplice di NOP. Viene inserito un byte contenente l'istruzione nulla che si limita a far avanzare l'extraction pointer di uno step. Quando IP punta a un qualsiasi elemento del vettore contentente l'istruzione nulla, questo viene incrementato di uno fino a quando non raggiunge il codice.

### Indirizzo di Ritorno Ripetuto dopo lo Shellcode
L'indirizzo di ritorno viene ripetuto diverse volte alla fine dello shellcode. Una startegia molto utilizzata è quella che prevede entrambe queste tecniche, ottenenendo:

| NOP sled | Shellcode | Indirizzo di Ritorno Ripetuto |

# Vulnerabilità Web App
E' sempre bene controllare che il tipo di input ricevuto sia conforme a quello che ci si aspetta.

## SQL Injection
Si tratta di iniezioni di codice SQL all'interno dell'applicazione. Questa tipologia di tecniche servono per ottenere informazioni sul database e quindi per manipoalrne i dati, e fare in questo modo fare il *fingerprinting del database*. Lo strumento più utilizzato per automatizzare le SQL Injection prende il nome di SQLMap. E' bene non mettere mai errori espliciti sulle chiamate fatte su delle pagine HTML. Gli errori vanno gestiti correttamente per non portare in output all'attaccante informazioni utili per i suoi scopi.

### Blind SQL Injection
Si opera alla cieca. Non si vedopno direttamente i risultati della SQL Injection, ma solo delle cose che dipendono da essa.

### Injection basate su UNION
La direttiva `UNION` consente di unire i risultati di due query diverse. Utile per eseguire una nuova query in coda ad una già esistente. E' necessario conoscere il numero di colonne di ritorno e il loro tipo.

### Numero di Colonne con ORDER BY
`ORDER BY` ordina i risultati sulla base del valore di una colonna. La colonna può essere identificata dal *nome della colonna*, oppure dalla *sua posizione* (indice della colonna). Non è pertanto necessario conoscere il nome della colonna che si va ad ordinare.

### Accesso ai File
Molti database dispongono di funzioni per leggere informazioni da file o per scriverne uno. Questo rappresenta una vulnerabilità sfruttabile dall'attaccante. Normalmente un database *non deve avere accesso in scrittura alle cartelle del Web Server*.

La SQL Injection rimane una delle vulnerabilità più comuni all'interno delle Applicazioni Web. Viene comunemente utilizzata per attacchui mirati al furto di dati sensibili (carte di credito, dati sanitari).

## Cross Site Scripting
Consiste nell'inserire del codice JavaScript all'interno dell'app vulnerabile che viene eseguito sul browser della vittima. Ne esistono diverse tipologie:
- Non Persistente (o Riflesso)
- Persistente (o Stored): l'attaccante crea un payload che il sito web replica sulla vittima. Attacchi meno frequenti.

Queste tipologie di attacchi sono possibili quando esiste uno script che non filtra in maniera opportuna l'input dell'utente.

Un attaccante ricerca siti vulnerabili in maniera più o meno automatica, testando i diversi campi di input. in questo modo utilizza un URL con hostname legittimo ma contenente codice malevolo da inviare all'utente. Attraverso XSS è anche possibile modificare delle pagine. Questo tipo di attacchi non viene sempre fatto sui siti veri e propri, ma anche su siti creati appositamente che riprendono la grafica del sito reale.

La garania che mi da HTPPS è la garanzia di star comunicando veramente con il sito specificato nell'url. I dati scambiani in questo sito sono cifrati. Non garantisce che il contenuto del sito sia legittimo e che non sia stato manomesso.

### Provvedimenti
Gli input presenti in una richiesta che arriva al server sono tanti (Parametri GET/POST, Headers, Cookie, User Agent). Se su questi non si effettua un'opportunazione validazione è possibile che vengano manipolati dall'utente per accedere a dati protetti. 
    
    Esempio: UA nella Richiesta
    Nell'UA viene solitamente salvato il browser di navigazione e la sua versione. Un attaccante potrebbe inviare in questa informazione dei comandi per accedere direttamente al database e compiere le operazioni desiderate.

    Esempio: Cookie di Sessione
    Nei cookie di sessione viene salvata la posizione di accesso di un'utente a una determinata posizione. Se questa cambia, il sito può scegliere di notificare l'utente affinchè verifichi la sua identità e la sua nuova posizione.

# Causa delle Vulnerabilità 
La causa comune a tutti i tipi di vulnerabilitò risiede nella validazione poco efficiente dell'input. La mancata validazione di input causa la mancata verifica di come il programma si comporta in certe condizioni.

## Buffer Overflow - Good Practices 
### Livello di Programmazione
- Aumentare il controllo sui dati (parametri) derivanti dall'esterno.
  - Utilizzo di funzioni "protette", come ad esempio *strncopy* anzichè *strcopy*. *strncopy* copia i caratteri fino a quando ci stanno nel buffer, scarta i rimanenti: consente di specificare il numero di caratteri da copiare. *strncopy* copia i dati all'interno dell'aria di memoria.
  - Utilizzo di funzioni di libreria "sicure". Utilizzare versioni modificate e rese affidabili di funzioni di libreria vulnerabili.

### Livello di Kernel
- Controllo degli accessi in memoria 
- Mappare aree di memoria in modo casuale (randomizzazione)

Accorgimenti di questo tipo a volte vanno a pesare sulle prestazioni: ogni volta che si riceve una chiamata è necessario valutare se questa è fattibile o meno.

### Livello di Compilatori
Utilizzo di *stack canary*. Quando si fa uno stack overlflow si deve arrivare a sovrascrivere l'extraction pointer. Prima di sovrascrivere l'extraction pointer si brasa tutta la memoria precedente. Può essere una buona idea andare a inserire nel file binario un valore logico in prossimità dell'extraction pointer (un canarino) e quando si fanno cambi di contesto (passaggi da un frame all'altro) si controlla che il canarino sia ancora integro. Questa tecnica non previene il buffer overflow ma lo rende più difficile: l'attaccante deve leggere e sovrascrivere l'extraction pointer preservando il valore del canary.

## SQL Injection - Good Practices 
Anche in questo caso è necessario validare i dati di input facendo uso, ad esempio, di *regular expressions*.

### Prepared Statement
Rappresenta una soluzione definitiva alla SQL Injection. Impedisce di fare confusione tra il codice della query e gli input inseriti dell'utente. Ogni query viene precedentekmente preparata e i suoi input validati.

## XSS - Good Practices
I caratteri speciali devono essere eliminati o codificati (per evitare che vengano utilizzati in uno script). Questi caratteri devono ediventare safe (HTML-safe) per essere utilizzati all'interno di un linguaggio come HTML. Per PHP esiste la funzione *htmlspecialchars*.

In generale, la soluzione rimane sempre quella di *validare l'input*.

# Malware
Quando i bersagli sono molteplici gli attaccanti tengono ad utilizzare dei loro script (tools) chiamati Malware, che hanno lo scopo di *causare danni* a un'organizzazione. Il termine Malware è la nozione più moderna del termine più tradizionale *virus* e significa *MALicious softWARE*. E' un termine cappello con il quale si fa riferimento a un qualsiasi programma software implementato per *scopi malevoli*. Prima di internet i malware non erano frequenti. Con l'utilizzo di internet anche per scopi commerciali nasce l'esigenza degli attaccanti di automatizzare i processi. Tendenzialmente queste tipologie di virus erano distruttivi, con l'intenzione di farsi notare. Con l'arrivo dei criminali informatici ci si rende conto che più una macchina rimane infetta per più tempo è possibile sfruttarne i dati e le vulnerabilità. I malware che non immediatamente attaccano e cercano di mantenere la loro permanenza nel sistema per più tempo possibile vengono chiamati *ghostware*, in quanto non evidenziano la loro presenza. I *malware latenti*, così chiamati, tendono a nascondersi in profondità e risultano difficili da estirpare in quanto continuano a riprodursi automaticamente in diversi posti e  (modificando ad esempio altri eseguibili di sistema). Gli obiettivi principali di un malware sono i seguenti:
1. Installarsi 
2. Mascherarsi
3. Replicarsi

In seguito, può decidere di:
- Manifestarsi alla vittima (cancellando e crittografando dati e chiedendo un riscatto)
- Attivarsi in modalità nascosta (aprendo porte a ulteriori attacchi)
- Informare l'attaccante (generalmente un server, non lui direttamente) dell'avvenuta insrtallazione quando il computer si connette a internet
- Diffondersi automaticamente attraverso cartelle condivise o via email

Solitamente ci si infetta attraverso email, applicazioni web, installazione di software non certificato e file sharing. Oggi i *malware sono realizzati per scopi professionali*, quali ad esempio lo spionaggio.

## Tipologie

### Virus
Il *virus informatico* ha questo nome per la sua somiglianza ai virus biologici. E' un pezzo di codice aggiunto a un programma esistente che si replica e diffonde in maniera autonoma da un eseguibile all'altro, da un computer all'altro.


### Trojan
Si tratta di un *veicolo* per diffondere il malware. Si tratta di un programma collegato a un altro di natura innocua, sul quale viene caricato. E' l'utente che *intenzionalmente* scarica il programma e lo manda in esecuzione. Quest'ultimo viene convinto mediante tecniche derivanti da una *buona ingegneria sociale* (facendo il sito in un certo modo).

### Logic Bomb
Malware che rimane silente fino al verificarsi di un certo evento (ricorrenza o una data).

### Virus Polimorfico
Fino a qualche anno fa, se il Malware rimaneva sempre lo stesso, non veniva aggiornato e guadagnava una certa fama, venivano caricate le sue *firme virali* all'interno degli antivirus, che permettevano il riconoscimento di quel determinato pezzo di codice. Per contrastare questa meccanica, nascono così i *virus polimorfici*. L'idea alla base è quella di cifrare la porzione di codice malevolo con una chiave che cambia tutte le volte. I pezzi non cifrati corrispondono ad una *routine di decifratura* (la chiave). Quando il malware viene mandato in esecuzione la routine di decifratura legge la chiave che decifra il virus. Questo rimane in memoria e viene mandato in esecuzione. Sulla routine di decifratura sarebbe possibile fare una firma virale, ma i programmi che decodificano sono molto comuni: si rischierebbe di identificare come malware anche programmi che non lo sono (ad esempio Winzip). Per questo motivo l'antivirus è *sempre in esecuzione* e monitora il codice dei processi in esecuzione.

### Virus Metamorfico
Virus in grado di mutare completamente il proprio codice ad ogni replica. Possono fare uso della codifica, ma oltre ad essa è il codice che viene proprio modificato. Le attività del virus vengono così spezzate in tante piccole sotto-funzioni logiche, ciascuna sviluppabile in modo diverso. Questo lo rende molto difficile da individuare (non si deve fare la firma sull'intero eseguibile ma sui singoli pezzi, che non necessariamente però sono tutti malevoli).

### Confronto Virus e Worm
Un virus non è un programma a se' stante. Un worm sì. Un worm prova a progagarsi da solo senza attività di social engineering (come nel caso di un Trojan). Un worm generalmente ricerca *una vulnerabilità nota*. Un worm si porta dietro una *libreria di vulnerabilità note*. L'efficacia di un worm dipende dalle vulnerabilità che è in grado di sfruttare: ciò dipende da quanto è diffuso il software e l'età della vulnerabilità che si sta sfruttando.

## Ciclo di Vita delle Vulnerabilità
Una vulnerabilità nasce quando viene programmato il software vulnerabile. Una vulnerabilità può essere rilevata prima dall'antivirus, da un addetto di sicurezza informatica o dal vendor stesso (nei casi migliori). Quando il vendor ne viene informato sviluppa una patch per risolverla, che viene rilasciata pubblicamente. La vulnerabilità si estingue quando la patch viene installata.

### Attacchi Zero-day
Sono quei tipi di attacchi che si subiscono ancora prima di sapere che il proprio sistema è vulnerabile, quando non c'è una firma virale e l'antivirus non rileva il malware. Durante questi attacchi le vulenerabilità non sono note ne' state divulgate pubblicamente. Gli attacchi di *follow on*, che seguono la scoperta della presenza di una vulnerabilità, sono molto più comuni. Gli attacchi zero day sono molto poco frequenti e costosi, solitamente fatti ai danni di aziende importanti.

## Scopi dello Spyware
Non sempre hanno scopi dannosi. Molti hanno il solo obiettivo di reperire i nostri dati e informazioni per poi venderli per scopi pubblicitari. Altri, dannosi, rubano le password e le credenziali per i conti bancari. Alcuni malware possono essere usati anche solo per *scopi investigativi* per profilare una persona. Alcuni di questi software, utilizzati da entità come FBI, NSA, CIA, potrebbero comparire in delle white list e quindi essere consentiti dalle società antivirus.

## Ransomware
Letteralmente "malware per ricattare", usati dal 2016. Quando mandato in esecuzione cerca immediatamente di contattare un *command and control* (infrastruttura di attacco) che gestisce chiavi di cifratura e decifratura. Questa infrastrutta di attacco dirà al malware quali chiavi utilizzare per cifrare i files. Il malware cifra i file di interesse (non tutto se no il sistema non funziona più), generalmente di interesse *per l'utente*, con un valore economico o sentimentale. Una volta criptati la chiave di cifratura viene eliminata e viene informato l'utente di pagare un riscatto, generalmente attraverso qualche forma di criptovaluta.

## Cyber Weapon
Le categorie di malwares che rientrano in questa categoria sono da considerarsi "Cyber Weapon". I gruppi criminali che creano malwares talvolta sono sovvenzionate da infrastrutture statali, i loro servizi sono legati a scopi di contrasto tra stati, attività di guerra vera e propria. Questi tipo di malware talvolta hanno come obiettivo uno stato.

### Esempi di CW
#### Stuxnet
Stuxnet è stato quello che ha fatto più scalpore, e con un target specifico: è riuscito a compromettere gli impianti dell'Iran per arrichire l'uranio. La vittima è l'impianto stesso, l'arrichimento viene fatto da delle centrifughe controllate da dei PLC configurati da delle workstation. (Nei sistemi industriali i PLC sono tipicamente controllati da sistemi SCADA System Control and Acquisition, attraverso cui è possibile controllare e configurare i parametri di produzione delle macchine). Nel caso di impianti nazionali queste reti sono reti *Air gap*, non connesse a nulla che sia su internet (garantisce protezione). Il primo strumento di infezione è una chiavetta usb. All'interno della rete locale ne sfrutta le vulnerabilità (stampanti condivise). Il malware guardava se era in esecuzione il software Scada e se il computer era connesso a un PLC, e se questo stava pilotando delle centrifughe. Rimaneva silente fino a quando non trovava il suo obiettivo specifico. Quando trovava un PLC, gli ordinava ogni tanto di calare in modo molto rapido il processo di rotazione delle centrifughe. Questo diminuiva di parecchio la qualità dell'arricchimento dell'uranio. Nell'ipotesi in cui nessuno lo avesse rilevaato, il malware si sarebbe disinstallato da solo. Aveva un'architettura modulare, se arrivavano nello stesso pc due versioni del software, manteneva quella più recente. Questo malware rappresentò una rivoluzione anche dal punto di vista della sicurezza per le aziende.

#### Red October
Primo malware di spionaggio multipiattafroma. Ha avuto ua diffusione estesa.

#### NotPetya
La firma su un software mi consente di verificare che un software sia integro e che quindi non sia stato modificato dopo il suo rilascio. Generalmente si presentevava come Ransomware. L'attaccante era riuscito a risalire alle informazioni che gli servivano, come la chiave privata ed è riuscito a realizzare un malware firmato digitalmente dall'azienda stessa. In realtà il malware era un *wiper*, aveva un solo *scopo distruttivo* e l'intento non era dunque quello di monetizzare. Il malware ha avuto successo, infettando più di 1 milione di computer.

## Advanced Persistent Treat (APT)
Si tratta di *gruppi di professionisti*, finanziati e con competenze elevate che generalemnte operano sotto copertura e per un certo periodo di tempo. generalmente riguardano aziende medio-grandi in quanto richiedono investimenti costosi. Solitamente sono *organizzazioni para-statali*, ma possono anche essere *criminali*, che su richiesta di alcuni stati possono mettere a disposizione le loro competenze. Le attività di un APT si divide in step:
- INTELLIGENCE: fase in cui si raccolgono (o comprano) infromazioni sulla vittima
- TECNOLOGIA: si crea il malware 
- PSICOLOGIA: attività di software engineering, si fa arrivare il malware alla vittima comunicando con essa presentandosi come "amici"

Con il termine si fa riferimento quindi a un *gruppo di persone competenti* che *usano malware* e tecnolgie di attacco specializzate e *conducono operazioni di attacco*. Questi attacchi sono particolarmente efficaci perchè conducono attività di ricerca per mantenersi aggiornati, specie per le tipolgie di attacco *zero-day*. Questi gruppi *sperimentano tanto* e non sono legati ad una sola tecnologia.

## Tipologie di Attacchi
Gli attacchin informatici possono essere *volatili* o *persistenti*: quando si vuole rubare dei dati, la sottrazione dei dati può cominciare dei minuti dopo l'infezione oppure dopo dei mesi.

## Lateral Movement
L'attaccante cerca di accedere sempre ad un host con più privilegi. L'obiettivo può anche trovarsi in una rete diversa da quella della prima vittima.

## Man in the Middle (MitM)
Anche questa tipologia di attacco può essere utilizzata come tecnica di *ricognizione*. Uno dei modi per farlo è facendo *Pass the Hash*, che riguarda un meccanismo di autenticazione delle macchine locali windows. Una volta infettato un host, per garantire la sua persistenza nel sistema quest'ultimo installa un *RAT* (Remote Access Trojan).
